<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TURNO</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<style>
body{
  margin:0;
  font-family: monospace;
  background:#000;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
#game{
  width:92%;
  max-width:420px;
  text-align:center;
}
#clock{font-size:2.6em;}
#gauge{
  margin:15px 0;
  width:100%;
  height:12px;
  background:#222;
  border-radius:6px;
  overflow:hidden;
}
#gaugeFill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#ff0033,#ff6600);
  transition:width 1s linear;
}
#text{
  min-height:90px;
  margin:15px 0;
  opacity:.9;
}
button,input{
  width:100%;
  padding:10px;
  margin-top:8px;
  background:#111;
  color:#fff;
  border:1px solid #333;
}
button:hover{background:#222;}
small{opacity:.6}
</style>
</head>

<body>

<div id="game">
  <div id="clock"></div>
  <div id="gauge"><div id="gaugeFill"></div></div>
  <div id="text"></div>

  <input id="nameInput" placeholder="Seu nome">
  <button id="startBtn">Iniciar turno</button>

  <div id="choices" style="display:none">
    <button onclick="act(0)">Ignorar</button>
    <button onclick="act(1)">Pensar demais</button>
    <button onclick="act(2)">Surtar em silêncio</button>
  </div>

  <small id="status"></small>
</div>

<script>
let state={
  name:localStorage.getItem("name")||"",
  sanity:Number(localStorage.getItem("sanity"))||100,
  day:Number(localStorage.getItem("day"))||1,
  started:false,
  used:[]
};

const pools={
  work:[
    "O relógio parece te observar.",
    "O silêncio pesa.",
    "Você sente que já viveu isso.",
    "Nada acontece. Isso é o problema.",
    "O tempo não colabora."
  ],
  pause:[
    "Pausa. O corpo existe.",
    "18h. O mundo desacelera.",
    "Você esquece quem é por 1 minuto."
  ],
  end:[
    "Turno encerrado.",
    "Você sobreviveu.",
    "A noite aceita você."
  ]
};

function unique(pool){
  let list=pools[pool].filter(x=>!state.used.includes(x));
  if(!list.length){state.used=[];list=pools[pool]}
  const msg=list[Math.floor(Math.random()*list.length)];
  state.used.push(msg);
  return msg;
}

const text=e=>document.getElementById("text").textContent=e;
const status=e=>document.getElementById("status").textContent=e;

document.getElementById("nameInput").value=state.name;

document.getElementById("startBtn").onclick=()=>{
  const n=document.getElementById("nameInput").value.trim();
  if(!n)return;
  state.name=n;
  state.started=true;
  localStorage.setItem("name",n);
  document.getElementById("nameInput").style.display="none";
  document.getElementById("startBtn").style.display="none";
  document.getElementById("choices").style.display="block";
  text(`Dia ${state.day}. Turno iniciado, ${n}.`);
};

function act(i){
  if(i===1)state.sanity-=4;
  if(i===2)state.sanity-=8;
  save();
  text(unique("work"));
}

function save(){
  localStorage.setItem("sanity",state.sanity);
  localStorage.setItem("day",state.day);
}

function update(){
  const now=new Date();
  document.getElementById("clock").textContent=now.toLocaleTimeString();

  const start=new Date();start.setHours(14,0,0,0);
  const pauseS=new Date();pauseS.setHours(18,0,0,0);
  const pauseE=new Date();pauseE.setHours(19,0,0,0);
  const end=new Date();end.setHours(22,0,0,0);

  if(now<start){
    text(`Faltam ${Math.ceil((start-now)/60000)} min para o turno.`);
    return;
  }

  if(!state.started)return;

  if(now>=pauseS&&now<pauseE){
    text(unique("pause"));
  }
  else if(now>=end){
    text(unique("end")+` Dia ${state.day} concluído.`);
    state.day++;
    state.started=false;
    save();
    document.getElementById("choices").style.display="none";
  }
  else{
    text(unique("work"));
  }

  const prog=Math.min(100,Math.max(0,((now-start)/(end-start))*100));
  document.getElementById("gaugeFill").style.width=prog+"%";
  status(`Sanidade: ${state.sanity}% • Dia ${state.day}`);
}

setInterval(update,1000);
update();
</script>

</body>
</html>